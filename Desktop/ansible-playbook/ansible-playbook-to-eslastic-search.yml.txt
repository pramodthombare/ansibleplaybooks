---
 - hosts: testing
   remote_user: svc-gfilinux
   become: true
   become_user: root
   become_method: sudo
   gather_facts: True
   tasks:
     - name: checking the cluster status
       shell: curl -k http://localhost:9200/_cluster/health/?pretty | grep -i 'green\|yellow\|red'
       register: escm
     - debug: var=escm.stdout_lines


     - name: Wait until the string "green" before continue
       wait_for:
         msg: "{{ escm.stdout }}"